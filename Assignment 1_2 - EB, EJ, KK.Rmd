---
title: "Assignment 1_2"
author: "Emma Bonanno, Emily Johansen, Katia Krotova"
date: "10/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Research Question

Are there significant correlations between rural/suburban/urban characteristics, race, income, and majority county-level voting patterns in the 2020 presidential election? 


## Prior Research

Gimpel et. al (2020) find that urban–rural political party splits persist even after accounting for an array of individual-level characteristics, such as race, income and education. Hill et. al (2019) demonstrate that at the precinct level, local demographic changes and increasing diversity did not correlate to an increase in support for anti-immigration Republican candidates in the lead up to the 2016 presidential election. 


```{r, load packagaes and ACS, echo = FALSE, quiet = TRUE}
library(tidyverse)
library(tidycensus)
library(readxl)
library(knitr)
library(tigris)
library(sf)
library(gridExtra)

vars_2017 <- load_variables(2017, "acs5")
```
## Data

Our sample population for this analysis is the full set of all counties across the United States. The data included in the analysis is:


* People per square mile (American Community Survey 2017)
* Median income (American Community Survey 2017)
* Population identifying as White only and Black / African-American only (American Community Survey 2017)
* Majority vote in the 2020 presidential election (MIT Election Data and Science Lab, 2018)
* Urban-Rural County classification (National Center for Health Statistics 2013)


```{r, quiet = TRUE}
acs <- get_acs(geography = "county", 
                        year = 2017,
                        variables = c(total_pop = "B01003_001",
                                      med_inc = "B06011_001",
                                      Black = "B02001_003",
                                      white = "B02001_002"),
                        output = "wide",
                        geometry = TRUE)

areas <- counties() %>%
  st_set_geometry(NULL) %>%
  mutate(sq_miles = ALAND / 2589988.11) %>%
  select(GEOID, sq_miles)
```
Load suburban-rural classification
```{r}
CO_type <- read_xlsx(path = "data/NCHSURCodes2013.xlsx", 
                      sheet = "NCHSURCodes2013") %>%
  mutate(GEOID = case_when(str_length(as.character(`FIPS code`)) == 5 ~ 
                            as.character(`FIPS code`),
                          str_length(as.character(`FIPS code`)) == 4 ~
                            paste("0", `FIPS code`, sep=""),
                          TRUE ~ "unknown")) %>%
  mutate(type = case_when(`2013 code` == 1 ~ "Large central metro",
                          `2013 code` == 2 ~ "Large fringe metro",
                          `2013 code` == 3 ~ "Medium metro",
                          `2013 code` == 4 ~ "Small metro",
                          `2013 code` == 5 ~ "Micropolitan",
                          `2013 code` == 6 ~ "Non-core",
                          TRUE ~ "unknown")) %>%
  select(GEOID, type)
```

Load election result (Democrat/Republican) data
```{r, quiet = TRUE}
election <- read_csv('data/countypres_2000-2020.csv') %>%
  filter(year == 2020) %>%
  filter(party == "REPUBLICAN") %>%
  rename(GEOID = county_fips) %>%
  group_by(GEOID) %>%
  summarize(candidatevotes = sum(candidatevotes),
            totalvotes = first(totalvotes)) %>%
  mutate(pct_GOP = candidatevotes / totalvotes) %>%
  mutate(majority_vote = ifelse(pct_GOP > 0.5, "Republican", "Democrat")) %>%
  select(GEOID, pct_GOP, majority_vote)
```

```{r}
election <- election %>%
   mutate(GEOID = as.character(GEOID))
```
Join datasets: 
```{r}
data <- left_join(acs, areas) %>%
  left_join(election) %>%
  left_join(CO_type) %>%
  mutate(pop_dens = total_popE / sq_miles) %>%
  select(GEOID, NAME, total_popE, pop_dens, med_incE, BlackE, whiteE, type, majority_vote)

kable(head(data))
```
## Descriptive Statistics

# Continuous Variables

The continuous variable used in this research are population density, median income, population identifying as White-only, and population identifying as Black or African American-only. 

# Calculations

```{r}

```

```{r}

```
# Displaying Results

```{r}

```
## Categorical Variables

The categorical variable used in this analysis are:

* The party of the candidate who won the most votes in the 2020 presidential election
* The county type (non-core, micropolitan, metropolian, etc), based on the NCHS classification.

# Calculations

```{r}

```


# References

Gimpel, J.G., N. Lovin, B. Moy, & A. Reeves (2020). "The Urban–Rural Gulf in American Political Behavior". Political Behavior, 42, 1343-1368.

Hill, Seth J.,  Daniel J. Hopkins, Gregory A. Huber (2019). "Local demographic changes and US presidential voting, 2012 to 2016". Proceedings of the National Academy of Arts and Sciences, December 10, 2019 116 (50) 25023-25028. 





